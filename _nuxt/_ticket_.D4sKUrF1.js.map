{"version":3,"file":"_ticket_.D4sKUrF1.js","sources":["../../../../utils/redirect.ts","../../../../pages/auth/2fa/verify/[ticket].vue"],"sourcesContent":["export function redirect(link: string) {\n  if (link.startsWith(\"http\")) {\n    location.href = link\n    return\n  }\n\n  navigateTo(link)\n}\n","<template>\n  <div class=\"flex flex-col items-center gap-4\">\n    <form class=\"flex w-72 flex-col gap-2\">\n      <v-label label=\"Authentication code\">\n        <v-input\n          v-model=\"form['2fa_code']\"\n          autofocus\n        />\n      </v-label>\n      <v-button\n        variant=\"primary\"\n        class=\"mt-2\"\n        :loading=\"isSubmitting\"\n        @click=\"submit\"\n      >\n        Login\n      </v-button>\n    </form>\n\n    <p class=\"text-sm\"><NuxtLink to=\"/auth\">Sign In</NuxtLink></p>\n  </div>\n</template>\n\n<script setup lang=\"ts\">\nimport type { Payload } from \"core/types/api\"\n\ndefinePageMeta({\n  requiredRole: \"guest\",\n  layout: \"centered\",\n})\n\nconst route = useRoute()\nconst form = reactive<Payload<typeof verify2FA>>({\n  \"2fa_code\": \"\",\n  ticket: route.params.ticket as string,\n})\n\nconst isSubmitting = ref(false)\nasync function submit() {\n  isSubmitting.value = true\n\n  try {\n    const response = await verify2FA(form)\n\n    const userStore = useUserStore()\n    await userStore.login(response.staff_token)\n\n    if (response.redirect_uri) {\n      return redirect(response.redirect_uri)\n    }\n  } finally {\n    isSubmitting.value = false\n  }\n}\n</script>\n"],"names":["redirect","link","navigateTo","route","useRoute","form","reactive","isSubmitting","ref","submit","response","verify2FA","useUserStore"],"mappings":"0VAAO,SAASA,EAASC,EAAc,CACjC,GAAAA,EAAK,WAAW,MAAM,EAAG,CAC3B,SAAS,KAAOA,EAChB,MACF,CAEAC,EAAWD,CAAI,CACjB,6ICwBA,MAAME,EAAQC,IACRC,EAAOC,EAAoC,CAC/C,WAAY,GACZ,OAAQH,EAAM,OAAO,MAAA,CACtB,EAEKI,EAAeC,EAAI,EAAK,EAC9B,eAAeC,GAAS,CACtBF,EAAa,MAAQ,GAEjB,GAAA,CACI,MAAAG,EAAW,MAAMC,EAAUN,CAAI,EAKrC,GAFM,MADYO,IACF,MAAMF,EAAS,WAAW,EAEtCA,EAAS,aACJ,OAAAV,EAASU,EAAS,YAAY,CACvC,QACA,CACAH,EAAa,MAAQ,EACvB,CACF"}